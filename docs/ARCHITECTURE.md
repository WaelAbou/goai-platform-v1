# SustainData AI - System Architecture

## Executive Overview

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                     │
│                           SUSTAINDATA AI PLATFORM                                   │
│                                                                                     │
│    ┌─────────────────────────────────────────────────────────────────────────────┐  │
│    │                         PRESENTATION LAYER                                  │  │
│    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │  │
│    │  │   Web App   │  │  Mobile App │  │  REST API   │  │  Webhooks   │         │  │
│    │  │  (React)    │  │  (Future)   │  │  (FastAPI)  │  │  (Inbound)  │         │  │
│    │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │  │
│    └─────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                          │
│    ┌─────────────────────────────────────┴───────────────────────────────────────┐  │
│    │                         APPLICATION LAYER                                   │  │
│    │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │  │
│    │  │   Document   │  │     ESG      │  │    Review    │  │   Analytics  │     │  │
│    │  │  Processing  │  │  Companion   │  │    Queue     │  │    Engine    │     │  │
│    │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘     │  │
│    └─────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                          │
│    ┌─────────────────────────────────────┴───────────────────────────────────────┐  │
│    │                            AI LAYER                                         │  │
│    │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │  │
│    │  │  LLM Router  │  │  RAG Engine  │  │  SQL Agent   │  │     OCR      │     │  │
│    │  │  (Multi-LLM) │  │  (Vector DB) │  │  (NL→SQL)    │  │   (Tesseract)│     │  │
│    │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘     │  │
│    └─────────────────────────────────────────────────────────────────────────────┘  │
│                                          │                                          │
│    ┌─────────────────────────────────────┴───────────────────────────────────────┐  │
│    │                           DATA LAYER                                        │  │
│    │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │  │
│    │  │   Unified    │  │   Vector     │  │ Conversation │  │    Audit     │     │  │
│    │  │   Database   │  │    Store     │  │   History    │  │     Logs     │     │  │
│    │  │  (SQLite)    │  │   (FAISS)    │  │  (SQLite)    │  │  (SQLite)    │     │  │
│    │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘     │  │
│    └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Detailed Component Architecture

### 1. Presentation Layer

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              PRESENTATION LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                          WEB APPLICATION (React)                             │   │
│  │                                                                               │   │
│  │   ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐           │   │
│  │   │  Dashboard │  │   Upload   │  │   Review   │  │  Companion │           │   │
│  │   │            │  │  Documents │  │   Queue    │  │    Chat    │           │   │
│  │   │ • KPIs     │  │            │  │            │  │            │           │   │
│  │   │ • Charts   │  │ • Drag/Drop│  │ • Approve  │  │ • AI Chat  │           │   │
│  │   │ • Trends   │  │ • Preview  │  │ • Reject   │  │ • History  │           │   │
│  │   └────────────┘  └────────────┘  └────────────┘  └────────────┘           │   │
│  │                                                                               │   │
│  │   ┌────────────┐  ┌────────────┐  ┌────────────┐                            │   │
│  │   │ Analytics  │  │    My      │  │  Settings  │    Tech Stack:             │   │
│  │   │            │  │Submissions │  │            │    • React 18              │   │
│  │   │ • Reports  │  │            │  │ • Profile  │    • TypeScript            │   │
│  │   │ • Export   │  │ • History  │  │ • Roles    │    • Tailwind CSS          │   │
│  │   └────────────┘  └────────────┘  └────────────┘    • React Query           │   │
│  │                                                                               │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐   │
│  │                           REST API (FastAPI)                                 │   │
│  │                                                                               │   │
│  │   Endpoints:                              Features:                          │   │
│  │   • /api/v1/sustainability/*              • OpenAPI/Swagger Docs             │   │
│  │   • /api/v1/review/*                      • CORS Enabled                     │   │
│  │   • /api/v1/companion/*                   • Request Validation               │   │
│  │   • /api/v1/conversations/*               • Error Handling                   │   │
│  │   • /api/v1/sql/*                         • Rate Limiting (future)           │   │
│  │   • /api/v1/rag/*                                                            │   │
│  │                                                                               │   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

### 2. Application Layer

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              APPLICATION LAYER                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                      SMART DOCUMENT PROCESSING                                │  │
│  │                                                                                │  │
│  │   ┌────────────┐    ┌────────────┐    ┌────────────┐    ┌────────────┐      │  │
│  │   │   INPUT    │───▶│    OCR     │───▶│ CLASSIFY   │───▶│  EXTRACT   │      │  │
│  │   │            │    │            │    │            │    │            │      │  │
│  │   │ • Images   │    │ • Tesseract│    │ • LLM      │    │ • Template │      │  │
│  │   │ • PDFs     │    │ • GPT-4V   │    │ • Rules    │    │ • LLM      │      │  │
│  │   │ • Text     │    │            │    │            │    │            │      │  │
│  │   └────────────┘    └────────────┘    └────────────┘    └────────────┘      │  │
│  │                                                               │               │  │
│  │                                                               ▼               │  │
│  │   ┌────────────┐    ┌────────────┐    ┌────────────┐    ┌────────────┐      │  │
│  │   │  DATABASE  │◀───│  APPROVE   │◀───│   REVIEW   │◀───│ CALCULATE  │      │  │
│  │   │            │    │            │    │   QUEUE    │    │   CO₂e     │      │  │
│  │   │ • Unified  │    │ • Auto     │    │            │    │            │      │  │
│  │   │ • Persist  │    │ • Manual   │    │ • Pending  │    │ • Factors  │      │  │
│  │   └────────────┘    └────────────┘    └────────────┘    └────────────┘      │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                         ESG COMPANION AGENT                                   │  │
│  │                                                                                │  │
│  │   User Query ───▶ ┌─────────────────────────────────────────┐               │  │
│  │                   │           QUERY ROUTER                   │               │  │
│  │                   └──────────────┬──────────────────────────┘               │  │
│  │                                  │                                           │  │
│  │              ┌───────────────────┼───────────────────┐                      │  │
│  │              ▼                   ▼                   ▼                      │  │
│  │        ┌──────────┐        ┌──────────┐        ┌──────────┐                │  │
│  │        │ SQL Agent│        │RAG Engine│        │LLM Direct│                │  │
│  │        │          │        │          │        │          │                │  │
│  │        │"What's my│        │"How to   │        │"Explain  │                │  │
│  │        │ total    │        │ reduce   │        │ Scope 3" │                │  │
│  │        │ CO₂e?"   │        │ Scope 3?"│        │          │                │  │
│  │        └────┬─────┘        └────┬─────┘        └────┬─────┘                │  │
│  │             │                   │                   │                       │  │
│  │             └───────────────────┼───────────────────┘                       │  │
│  │                                 ▼                                           │  │
│  │                   ┌─────────────────────────┐                               │  │
│  │                   │    LLM SYNTHESIZER      │                               │  │
│  │                   │   Combine all sources   │                               │  │
│  │                   └────────────┬────────────┘                               │  │
│  │                                │                                             │  │
│  │                                ▼                                             │  │
│  │                   ┌─────────────────────────┐                               │  │
│  │                   │   RESPONSE + HISTORY    │                               │  │
│  │                   └─────────────────────────┘                               │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

### 3. AI Layer

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                   AI LAYER                                           │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                            LLM ROUTER                                         │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                     PROVIDER ABSTRACTION                             │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                  │                                            │  │
│  │          ┌───────────────────────┼───────────────────────┐                   │  │
│  │          ▼                       ▼                       ▼                   │  │
│  │   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐           │  │
│  │   │   OpenAI    │         │  Anthropic  │         │   Ollama    │           │  │
│  │   │             │         │             │         │   (Local)   │           │  │
│  │   │ • GPT-4o    │         │ • Claude 3  │         │ • Llama 3   │           │  │
│  │   │ • GPT-4     │         │ • Claude 3.5│         │ • Mistral   │           │  │
│  │   │ • GPT-3.5   │         │             │         │ • Custom    │           │  │
│  │   └─────────────┘         └─────────────┘         └─────────────┘           │  │
│  │                                                                                │  │
│  │   Features:                                                                   │  │
│  │   • Automatic fallback chain                                                  │  │
│  │   • Load balancing                                                            │  │
│  │   • Cost tracking                                                             │  │
│  │   • Response caching                                                          │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                            RAG ENGINE                                         │  │
│  │                                                                                │  │
│  │   ┌───────────────┐    ┌───────────────┐    ┌───────────────┐               │  │
│  │   │   INGEST      │───▶│   EMBED       │───▶│    STORE      │               │  │
│  │   │               │    │               │    │               │               │  │
│  │   │ • Documents   │    │ • OpenAI      │    │ • FAISS       │               │  │
│  │   │ • Text chunks │    │ • ada-002     │    │ • SQLite      │               │  │
│  │   │ • Metadata    │    │ • 1536 dims   │    │ • Persistent  │               │  │
│  │   └───────────────┘    └───────────────┘    └───────────────┘               │  │
│  │                                                                                │  │
│  │   ┌───────────────┐    ┌───────────────┐    ┌───────────────┐               │  │
│  │   │   RETRIEVE    │◀───│   RERANK      │◀───│    QUERY      │               │  │
│  │   │               │    │               │    │               │               │  │
│  │   │ • Top-K       │    │ • Cross-enc   │    │ • Semantic    │               │  │
│  │   │ • Threshold   │    │ • MMR         │    │ • Hybrid      │               │  │
│  │   │ • Context     │    │               │    │               │               │  │
│  │   └───────────────┘    └───────────────┘    └───────────────┘               │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                            SQL AGENT                                          │  │
│  │                                                                                │  │
│  │   ┌───────────────────────────────────────────────────────────────────────┐  │  │
│  │   │  "Show me emissions    ┌──────────────┐   SELECT doc_type,            │  │  │
│  │   │   by document type"  ──▶│  NL → SQL   │──▶ SUM(co2e_kg)              │  │  │
│  │   │                        │  Generator   │   FROM emissions              │  │  │
│  │   │                        └──────────────┘   GROUP BY doc_type           │  │  │
│  │   └───────────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                                │  │
│  │   Schema Registry:                                                            │  │
│  │   • emission_documents    • carbon_footprints    • esg_scores                │  │
│  │   • emission_entries      • companies            • audit_log                 │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                          OCR ENGINE                                           │  │
│  │                                                                                │  │
│  │   ┌─────────────┐         ┌─────────────┐         ┌─────────────┐           │  │
│  │   │   Image     │────────▶│  Tesseract  │────────▶│    Text     │           │  │
│  │   │   Input     │         │   OCR       │         │   Output    │           │  │
│  │   │             │         │             │         │             │           │  │
│  │   │ • PNG/JPG   │         │ • English   │         │ • Cleaned   │           │  │
│  │   │ • PDF       │         │ • Numbers   │         │ • Structured│           │  │
│  │   │ • Scan      │         │             │         │             │           │  │
│  │   └─────────────┘         └─────────────┘         └─────────────┘           │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

### 4. Data Layer

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                  DATA LAYER                                          │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                    UNIFIED SUSTAINABILITY DATABASE                            │  │
│  │                      (sustainability_unified.db)                              │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                         SCHEMA                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  │   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐                │  │
│  │   │   companies    │  │emission_documents│ │ emission_entries│               │  │
│  │   │                │  │                │  │                │                │  │
│  │   │ • id           │  │ • id           │  │ • id           │                │  │
│  │   │ • name         │◀─│ • company_id   │──│ • document_id  │                │  │
│  │   │ • industry     │  │ • doc_type     │  │ • category     │                │  │
│  │   │ • country      │  │ • co2e_kg      │  │ • scope        │                │  │
│  │   │ • created_at   │  │ • status       │  │ • co2e_kg      │                │  │
│  │   └────────────────┘  └────────────────┘  └────────────────┘                │  │
│  │                                                                                │  │
│  │   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐                │  │
│  │   │carbon_footprints│ │   esg_scores   │  │   audit_log    │                │  │
│  │   │                │  │                │  │                │                │  │
│  │   │ • company_id   │  │ • company_id   │  │ • action       │                │  │
│  │   │ • scope_1_kg   │  │ • env_score    │  │ • user_id      │                │  │
│  │   │ • scope_2_kg   │  │ • social_score │  │ • timestamp    │                │  │
│  │   │ • scope_3_kg   │  │ • gov_score    │  │ • details      │                │  │
│  │   │ • report_year  │  │ • overall      │  │                │                │  │
│  │   └────────────────┘  └────────────────┘  └────────────────┘                │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                         VECTOR STORE (FAISS)                                  │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │  Document Chunks                        Embeddings                   │    │  │
│  │   │  ┌──────────────────┐                  ┌──────────────────┐         │    │  │
│  │   │  │ "GRI 305 requires│                  │ [0.023, -0.156,  │         │    │  │
│  │   │  │  Scope 1, 2, 3   │  ──embedding──▶  │  0.892, ...]     │         │    │  │
│  │   │  │  reporting..."   │                  │  (1536 dims)     │         │    │  │
│  │   │  └──────────────────┘                  └──────────────────┘         │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  │   Index Type: Flat (FAISS)          Metric: Cosine Similarity                │  │
│  │   Persistence: SQLite backing       Dimension: 1536                          │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                    CONVERSATION STORE                                         │  │
│  │                  (platform_conversations.db)                                  │  │
│  │                                                                                │  │
│  │   ┌────────────────────────────────────────────────────────────────────┐     │  │
│  │   │  conversations                    messages                          │     │  │
│  │   │  ┌──────────────────┐            ┌──────────────────┐              │     │  │
│  │   │  │ • id             │            │ • id             │              │     │  │
│  │   │  │ • user_id        │◀───────────│ • conversation_id│              │     │  │
│  │   │  │ • agent_type     │            │ • role           │              │     │  │
│  │   │  │ • title          │            │ • content        │              │     │  │
│  │   │  │ • context_data   │            │ • tool_results   │              │     │  │
│  │   │  └──────────────────┘            └──────────────────┘              │     │  │
│  │   └────────────────────────────────────────────────────────────────────┘     │  │
│  │                                                                                │  │
│  │   Supports: esg_companion, meeting_notes, research_agent, custom              │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow Diagrams

### Document Processing Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          DOCUMENT PROCESSING FLOW                                    │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────┐                                                                       │
│  │  USER    │                                                                       │
│  │ uploads  │                                                                       │
│  │ document │                                                                       │
│  └────┬─────┘                                                                       │
│       │                                                                              │
│       ▼                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │ 1. INGESTION                                                                  │  │
│  │    ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                       │  │
│  │    │   Web UI    │   │   Email     │   │    API      │                       │  │
│  │    │  (Upload)   │   │ (Webhook)   │   │  (Direct)   │                       │  │
│  │    └──────┬──────┘   └──────┬──────┘   └──────┬──────┘                       │  │
│  │           └─────────────────┼─────────────────┘                               │  │
│  │                             │                                                  │  │
│  └─────────────────────────────┼────────────────────────────────────────────────┘  │
│                                ▼                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │ 2. TEXT EXTRACTION                                                            │  │
│  │    ┌─────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                     OCR ENGINE (Tesseract)                           │   │  │
│  │    │                                                                       │   │  │
│  │    │  Image/PDF ──▶ Text Extraction ──▶ Cleaned Text                      │   │  │
│  │    │                                                                       │   │  │
│  │    └─────────────────────────────────────────────────────────────────────┘   │  │
│  └─────────────────────────────┬────────────────────────────────────────────────┘  │
│                                ▼                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │ 3. CLASSIFICATION                                                             │  │
│  │    ┌─────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                    LLM CLASSIFIER                                    │   │  │
│  │    │                                                                       │   │  │
│  │    │  Text ──▶ Analyze ──▶ Document Type + Confidence                     │   │  │
│  │    │                                                                       │   │  │
│  │    │  Types: utility_bill_electric | flight_receipt | fuel_receipt        │   │  │
│  │    │         shipping_invoice | esg_report | expense_report | UNKNOWN     │   │  │
│  │    │                                                                       │   │  │
│  │    └─────────────────────────────────────────────────────────────────────┘   │  │
│  └─────────────────────────────┬────────────────────────────────────────────────┘  │
│                                │                                                     │
│              ┌─────────────────┴─────────────────┐                                  │
│              │                                   │                                  │
│              ▼                                   ▼                                  │
│  ┌───────────────────────┐          ┌───────────────────────┐                      │
│  │ 4a. KNOWN TYPE        │          │ 4b. UNKNOWN TYPE      │                      │
│  │     Use Template      │          │     Auto-Generate     │                      │
│  │                       │          │     Template          │                      │
│  │  Built-in templates:  │          │                       │                      │
│  │  • Utility Bill       │          │  LLM analyzes doc     │                      │
│  │  • Flight Receipt     │          │  and creates new      │                      │
│  │  • Fuel Receipt       │          │  extraction template  │                      │
│  │  • etc.               │          │                       │                      │
│  └───────────┬───────────┘          └───────────┬───────────┘                      │
│              │                                   │                                  │
│              └─────────────────┬─────────────────┘                                  │
│                                ▼                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │ 5. DATA EXTRACTION                                                            │  │
│  │    ┌─────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                    LLM EXTRACTOR                                     │   │  │
│  │    │                                                                       │   │  │
│  │    │  Text + Template ──▶ Structured Data                                 │   │  │
│  │    │                                                                       │   │  │
│  │    │  Example Output:                                                      │   │  │
│  │    │  {                                                                    │   │  │
│  │    │    "electricity_kwh": 1500,                                          │   │  │
│  │    │    "billing_period": "Dec 2024",                                     │   │  │
│  │    │    "cost_usd": 180                                                   │   │  │
│  │    │  }                                                                    │   │  │
│  │    │                                                                       │   │  │
│  │    └─────────────────────────────────────────────────────────────────────┘   │  │
│  └─────────────────────────────┬────────────────────────────────────────────────┘  │
│                                ▼                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │ 6. CO₂e CALCULATION                                                           │  │
│  │    ┌─────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                  EMISSION FACTORS                                    │   │  │
│  │    │                                                                       │   │  │
│  │    │  Electricity: 0.417 kg CO₂e/kWh                                      │   │  │
│  │    │  Natural Gas: 2.0 kg CO₂e/therm                                      │   │  │
│  │    │  Flight: 0.255 kg CO₂e/km (economy)                                  │   │  │
│  │    │  Diesel: 2.68 kg CO₂e/liter                                          │   │  │
│  │    │                                                                       │   │  │
│  │    │  1500 kWh × 0.417 = 625.5 kg CO₂e                                    │   │  │
│  │    │                                                                       │   │  │
│  │    └─────────────────────────────────────────────────────────────────────┘   │  │
│  └─────────────────────────────┬────────────────────────────────────────────────┘  │
│                                ▼                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │ 7. REVIEW QUEUE                                                               │  │
│  │    ┌─────────────────────────────────────────────────────────────────────┐   │  │
│  │    │                                                                       │   │  │
│  │    │  Confidence ≥ 85%  ───────▶  AUTO-APPROVE  ───────▶  Database       │   │  │
│  │    │                                                                       │   │  │
│  │    │  Confidence < 85%  ───────▶  PENDING       ───────▶  Human Review   │   │  │
│  │    │                              REVIEW                                   │   │  │
│  │    │                                                                       │   │  │
│  │    └─────────────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Integration Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          INTEGRATION ARCHITECTURE                                    │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                         EXTERNAL SYSTEMS                                      │  │
│  │                                                                                │  │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │  │
│  │   │     ERP     │  │   Travel    │  │  Accounting │  │   Energy    │        │  │
│  │   │   (SAP)     │  │  (Concur)   │  │(QuickBooks) │  │ (EnergyCAP) │        │  │
│  │   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │  │
│  │          │                │                │                │                │  │
│  └──────────┼────────────────┼────────────────┼────────────────┼────────────────┘  │
│             │                │                │                │                    │
│             ▼                ▼                ▼                ▼                    │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                      INTEGRATION LAYER                                        │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                    CONNECTOR FRAMEWORK                               │    │  │
│  │   │                                                                       │    │  │
│  │   │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐        │    │  │
│  │   │  │  REST API │  │  Webhook  │  │  File     │  │  Email    │        │    │  │
│  │   │  │  Polling  │  │  Receiver │  │  Import   │  │  Parser   │        │    │  │
│  │   │  └───────────┘  └───────────┘  └───────────┘  └───────────┘        │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                    DEDUPLICATION ENGINE                              │    │  │
│  │   │                                                                       │    │  │
│  │   │  • Same transaction from multiple sources?  → Merge                  │    │  │
│  │   │  • Matching criteria: date, amount, entity                           │    │  │
│  │   │  • Conflict resolution: Source priority                              │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                    DATA TRANSFORMATION                               │    │  │
│  │   │                                                                       │    │  │
│  │   │  External Schema  ──▶  Field Mapping  ──▶  Internal Schema           │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Security Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          SECURITY ARCHITECTURE                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                         AUTHENTICATION                                        │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                                                                       │    │  │
│  │   │  User ──▶ Login ──▶ JWT Token ──▶ API Access                         │    │  │
│  │   │                                                                       │    │  │
│  │   │  Supported Methods:                                                   │    │  │
│  │   │  • API Key (current)                                                  │    │  │
│  │   │  • JWT Bearer Token (future)                                          │    │  │
│  │   │  • OAuth 2.0 / SSO (future)                                          │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                         AUTHORIZATION (RBAC)                                  │  │
│  │                                                                                │  │
│  │   ┌────────────────────┬────────────────────┬────────────────────┐           │  │
│  │   │       ADMIN        │     SUPERVISOR     │        USER        │           │  │
│  │   ├────────────────────┼────────────────────┼────────────────────┤           │  │
│  │   │ ✅ All permissions │ ✅ Review queue    │ ✅ Upload docs     │           │  │
│  │   │ ✅ User management │ ✅ Approve/reject  │ ✅ View own data   │           │  │
│  │   │ ✅ System settings │ ✅ View analytics  │ ✅ ESG Companion   │           │  │
│  │   │ ✅ Audit logs      │ ✅ Bulk actions    │ ❌ Admin features  │           │  │
│  │   │ ✅ Delete data     │ ❌ User management │ ❌ Delete data     │           │  │
│  │   └────────────────────┴────────────────────┴────────────────────┘           │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                         DATA SECURITY                                         │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                                                                       │    │  │
│  │   │  In Transit:   TLS 1.3 encryption                                    │    │  │
│  │   │  At Rest:      Database encryption (configurable)                    │    │  │
│  │   │  API Keys:     Hashed storage                                        │    │  │
│  │   │  Audit:        Full action logging                                   │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          DEPLOYMENT OPTIONS                                          │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                    OPTION 1: SINGLE SERVER (Current)                          │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                      Single Machine                                  │    │  │
│  │   │                                                                       │    │  │
│  │   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                  │    │  │
│  │   │  │   FastAPI   │  │    React    │  │   SQLite    │                  │    │  │
│  │   │  │   Backend   │  │  Frontend   │  │  Databases  │                  │    │  │
│  │   │  │  :8000      │  │   :8080     │  │   /data/    │                  │    │  │
│  │   │  └─────────────┘  └─────────────┘  └─────────────┘                  │    │  │
│  │   │                                                                       │    │  │
│  │   │  Best for: Development, POC, Small teams                             │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                    OPTION 2: CONTAINERIZED (Docker)                           │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                    Docker Compose                                    │    │  │
│  │   │                                                                       │    │  │
│  │   │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │    │  │
│  │   │  │    backend    │  │   frontend    │  │   postgres    │           │    │  │
│  │   │  │   container   │  │   container   │  │   container   │           │    │  │
│  │   │  └───────┬───────┘  └───────────────┘  └───────┬───────┘           │    │  │
│  │   │          │                                      │                   │    │  │
│  │   │          └──────────────────────────────────────┘                   │    │  │
│  │   │                           │                                         │    │  │
│  │   │                    ┌──────┴──────┐                                  │    │  │
│  │   │                    │   volumes   │                                  │    │  │
│  │   │                    │   /data     │                                  │    │  │
│  │   │                    └─────────────┘                                  │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │                    OPTION 3: CLOUD NATIVE (Future)                            │  │
│  │                                                                                │  │
│  │   ┌─────────────────────────────────────────────────────────────────────┐    │  │
│  │   │                                                                       │    │  │
│  │   │  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐            │    │  │
│  │   │  │   AWS ECS   │     │  AWS RDS    │     │   AWS S3    │            │    │  │
│  │   │  │  (Backend)  │     │ (PostgreSQL)│     │  (Storage)  │            │    │  │
│  │   │  └─────────────┘     └─────────────┘     └─────────────┘            │    │  │
│  │   │                                                                       │    │  │
│  │   │  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐            │    │  │
│  │   │  │ CloudFront  │     │  OpenSearch │     │   Lambda    │            │    │  │
│  │   │  │  (CDN)      │     │  (Vector)   │     │ (Functions) │            │    │  │
│  │   │  └─────────────┘     └─────────────┘     └─────────────┘            │    │  │
│  │   │                                                                       │    │  │
│  │   └─────────────────────────────────────────────────────────────────────┘    │  │
│  │                                                                                │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Technology Stack Summary

| Layer | Technology | Purpose |
|-------|------------|---------|
| **Frontend** | React 18, TypeScript, Tailwind CSS | Web application |
| **API** | FastAPI, Pydantic, Uvicorn | REST API server |
| **AI - LLM** | OpenAI GPT-4, Anthropic Claude, Ollama | Language models |
| **AI - Embeddings** | OpenAI ada-002 | Vector embeddings |
| **AI - OCR** | Tesseract | Text extraction |
| **Vector Store** | FAISS | Similarity search |
| **Database** | SQLite | Data persistence |
| **Caching** | In-memory | Response caching |

---

## File Structure

```
goai-platform-v1/
├── api/
│   └── v1/
│       ├── sustainability.py      # Document processing APIs
│       ├── review_dashboard.py    # Review queue APIs
│       ├── esg_companion.py       # Chatbot APIs
│       ├── conversations.py       # Conversation history APIs
│       ├── sql_agent.py           # NL-to-SQL APIs
│       └── rag.py                 # RAG query APIs
├── core/
│   ├── llm/
│   │   └── router.py              # Multi-LLM routing
│   └── vector/
│       └── retriever.py           # Vector search
├── modules/
│   ├── sustainability/
│   │   ├── smart_ingestion.py     # OCR + Classification
│   │   ├── template_generator.py  # Auto-template creation
│   │   ├── unified_service.py     # Database operations
│   │   └── esg_companion.py       # Chatbot agent
│   ├── rag/
│   │   └── engine.py              # RAG pipeline
│   ├── sql_agent/
│   │   └── engine.py              # NL-to-SQL
│   └── conversations/
│       └── service.py             # Conversation persistence
├── emerald-flow/                  # React frontend
│   ├── src/
│   │   ├── pages/                 # Page components
│   │   ├── components/            # UI components
│   │   └── App.tsx                # Main app
│   └── package.json
├── data/                          # SQLite databases
│   ├── sustainability_unified.db
│   ├── platform_conversations.db
│   └── goai_platform.db
├── docs/                          # Documentation
│   ├── ARCHITECTURE.md            # This file
│   ├── PRODUCT_OVERVIEW.md
│   └── INTEGRATIONS.md
└── main.py                        # FastAPI entry point
```

---

**Version:** 1.0.0  
**Last Updated:** December 2024
